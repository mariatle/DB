USE MASTER;
GO

-- 1) Создать две базы данных на одном экземпляре СУБД SQL Server 2012
IF DB_ID('SKI_RENTAL_DB1') IS NOT NULL
	DROP DATABASE SKI_RENTAL_DB1;
GO

IF DB_ID('SKI_RENTAL_DB2') IS NOT NULL
	DROP DATABASE SKI_RENTAL_DB2;
GO

CREATE DATABASE SKI_RENTAL_DB1
ON 
(
	NAME = SKI_RENTAL_DB1,
	FILENAME = 'D:\SKI_RENTAL_DB1.MDF',
	SIZE = 10,
	MAXSIZE = UNLIMITED, 
	FILEGROWTH = 5%
)

CREATE DATABASE SKI_RENTAL_DB2 
ON 
(
	NAME = SKI_RENTAL_DB2,
	FILENAME = 'D:\SKI_RENTAL_DB2.MDF',
	SIZE = 10,
	MAXSIZE = UNLIMITED, 
	FILEGROWTH = 5%
)


-- 2) Создать в базах данных п.1. горизонтально фрагментированные таблицы.
USE SKI_RENTAL_DB1
GO

IF OBJECT_ID(N'dbo.SKIEQUIPMENT') IS NOT NULL
	DROP TABLE dbo.SKIEQUIPMENT;
GO

CREATE TABLE dbo.SKIEQUIPMENT
(
	EQUIPMENTID INT PRIMARY KEY NOT NULL CHECK (EQUIPMENTID < 3),
	MODEL NVARCHAR(50) NOT NULL CHECK (LEN(MODEL) > 1),
	BRAND NVARCHAR(50) NOT NULL CHECK (LEN(BRAND) > 1),
	SERIALNUMBER CHAR(10) NOT NULL,
	RENTALPRICE DECIMAL(10, 2) NOT NULL,
	AVAILABLEFROM DATE NOT NULL,
	AVAILABLETO DATE NULL
);
GO

USE SKI_RENTAL_DB2
GO

IF OBJECT_ID(N'dbo.SKIEQUIPMENT') IS NOT NULL
	DROP TABLE dbo.SKIEQUIPMENT;
GO

CREATE TABLE dbo.SKIEQUIPMENT
(
	EQUIPMENTID INT PRIMARY KEY NOT NULL CHECK (EQUIPMENTID >= 3),
	MODEL NVARCHAR(50) NOT NULL CHECK (LEN(MODEL) > 1),
	BRAND NVARCHAR(50) NOT NULL CHECK (LEN(BRAND) > 1),
	SERIALNUMBER CHAR(10) NOT NULL,
	RENTALPRICE DECIMAL(10, 2) NOT NULL,
	AVAILABLEFROM DATE NOT NULL,
	AVAILABLETO DATE NULL
);
GO



-- 3) Создать секционированные представления, обеспечивающие работу с данными таблиц (выборку, вставку, изменение, удаление).
IF OBJECT_ID(N'SKIEQUIPMENTVIEW') IS NOT NULL
	DROP VIEW SKIEQUIPMENTVIEW;
GO

CREATE VIEW SKIEQUIPMENTVIEW AS
	SELECT * FROM SKI_RENTAL_DB1.DBO.SKIEQUIPMENT
	UNION ALL
	SELECT * FROM SKI_RENTAL_DB2.DBO.SKIEQUIPMENT
GO


INSERT INTO SKIEQUIPMENTVIEW (EQUIPMENTID, MODEL, BRAND, SERIALNUMBER, RENTALPRICE, AVAILABLEFROM, AVAILABLETO) VALUES
(1, 'SKI SET A', 'ATOMIC', 'SN12345678', 50.00, '2024-12-01', '2025-01-01'),
(2, 'SKI SET B', 'SALOMON', 'SN87654321', 60.00, '2024-12-10', '2025-02-01'),
(3, 'SKI SET C', 'ROSSIGNOL', 'SN11223344', 70.00, '2024-11-15', '2025-01-20'),
(4, 'SKI SET D', 'FISCHER', 'SN22334455', 65.00, '2024-12-05', '2025-01-15'),
(5, 'SNOWBOARD SET A', 'BURTON', 'SN99887766', 80.00, '2024-11-20', '2025-02-01'),
(6, 'SKI SET E', 'K2', 'SN22334456', 55.00, '2024-12-12', '2025-01-10'),
(7, 'SNOWBOARD SET B', 'CAPITA', 'SN55443322', 90.00, '2024-12-20', '2025-01-25'),
(8, 'SKI SET F', 'NORDICA', 'SN77889933', 85.00, '2024-12-15', '2025-02-10'),
(9, 'SKI SET G', 'HEAD', 'SN44332211', 75.00, '2024-12-25', '2025-01-30'),
(10, 'SNOWBOARD SET C', 'ROME', 'SN11221133', 95.00, '2024-11-25', '2025-02-05'),
(11, 'SKI SET H', 'VOLKL', 'SN22335544', 60.00, '2024-12-01', '2025-01-05'),
(12, 'SNOWBOARD SET D', 'GNU', 'SN66778899', 85.00, '2024-12-30', '2025-01-15'),
(13, 'SKI SET I', 'ELAN', 'SN99887700', 50.00, '2024-12-01', '2025-01-01'),
(14, 'SKI SET J', 'MOMENT', 'SN11112233', 95.00, '2024-12-10', '2025-02-01'),
(15, 'SNOWBOARD SET E', 'LIB TECH', 'SN22336677', 110.00, '2024-12-05', '2025-01-20')
GO


SELECT * FROM SKIEQUIPMENTVIEW ORDER BY AVAILABLEFROM;

SELECT * FROM SKI_RENTAL_DB1.DBO.SKIEQUIPMENT;
SELECT * FROM SKI_RENTAL_DB2.DBO.SKIEQUIPMENT;
GO

UPDATE SKIEQUIPMENTVIEW
SET RENTALPRICE = 55.00 WHERE MODEL = 'SKI SET A'
GO

SELECT * FROM SKI_RENTAL_DB1.DBO.SKIEQUIPMENT;
SELECT * FROM SKI_RENTAL_DB2.DBO.SKIEQUIPMENT;
GO

DELETE FROM SKIEQUIPMENTVIEW
	WHERE MODEL = 'SKI SET C'
GO 

SELECT * FROM SKI_RENTAL_DB1.DBO.SKIEQUIPMENT;
SELECT * FROM SKI_RENTAL_DB2.DBO.SKIEQUIPMENT;
GO
